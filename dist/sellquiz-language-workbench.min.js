var slw=function(e,t,i){"use strict";function n(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(i){if("default"!==i){var n=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,n.get?n:{enumerable:!0,get:function(){return e[i]}})}})),t.default=e,Object.freeze(t)}var s,l=n(t),r=n(i);s=function(e){var t="CodeMirror-activeline",i="CodeMirror-activeline-background",n="CodeMirror-activeline-gutter";function s(e){for(var s=0;s<e.state.activeLines.length;s++)e.removeLineClass(e.state.activeLines[s],"wrap",t),e.removeLineClass(e.state.activeLines[s],"background",i),e.removeLineClass(e.state.activeLines[s],"gutter",n)}function l(e,l){for(var r=[],o=0;o<l.length;o++){var a=l[o],c=e.getOption("styleActiveLine");if("object"==typeof c&&c.nonEmpty?a.anchor.line==a.head.line:a.empty()){var d=e.getLineHandleVisualStart(a.head.line);r[r.length-1]!=d&&r.push(d)}}(function(e,t){if(e.length!=t.length)return!1;for(var i=0;i<e.length;i++)if(e[i]!=t[i])return!1;return!0})(e.state.activeLines,r)||e.operation((function(){s(e);for(var l=0;l<r.length;l++)e.addLineClass(r[l],"wrap",t),e.addLineClass(r[l],"background",i),e.addLineClass(r[l],"gutter",n);e.state.activeLines=r}))}function r(e,t){l(e,t.ranges)}e.defineOption("styleActiveLine",!1,(function(t,i,n){var o=n!=e.Init&&n;i!=o&&(o&&(t.off("beforeSelectionChange",r),s(t),delete t.state.activeLines),i&&(t.state.activeLines=[],l(t,t.listSelections()),t.on("beforeSelectionChange",r)))}))},"object"==typeof e&&"object"==typeof module?s(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],s):s(CodeMirror);var o="de";const a=" &#x2705; ",c=" &#x274C; ",d={definition_en:"Definition",definition_de:"Definition",theorem_en:"Theorem",theorem_de:"Satz",remark_en:"Remark",remark_de:"Bemerkung",please_wait_en:"please wait...",please_wait_de:"bitte warten...",evaluate_en:"Evaluate",evaluate_de:"Auswerten"};function u(e){return e+"_"+o in d?d[e+"_"+o]:"LANG.text('"+e+"'): unknown!"}class p{constructor(){this.id=0,this.src=""}}class h{constructor(){this.ident=""}}class m{constructor(){this.id=0,this.title="",this.code="",this.text="",this.solutiontext="",this.error="",this.solution={},this.inputs=[]}evaluate(){for(let e=0;e<this.inputs.length;e++){let t=this.inputs[e],i=document.getElementById("stackquiz-"+this.id+"-input-"+t.ident).value,n=document.getElementById("stackquiz-"+this.id+"-feedback-"+t.ident);Math.abs(parseFloat(this.solution[t.ident+"_float"])-parseFloat(i))<1e-5?n.innerHTML=a:n.innerHTML=c}}refresh(){let e=this;$.ajax({type:"POST",url:"services/maxima.php",data:{input:this.code},success:function(t){let i=t.split("\n"),n="",s="",l="",r="";for(let e=0;e<i.length;e++){let t=i[e].trim();t.endsWith(") values")?n="v":t.endsWith(") ev(values)")?n="ev":t.endsWith(") float(ev(values))")?n="ev_float":"v"==n?(s=t,n=""):"ev"==n?(l=t,n=""):"ev_float"==n&&(r=t,n="")}let o=0;for(let e=0;e<s.length;e++)if(")"==s[e]){o=e+3;break}let a=s.substring(o,s.length-1).trim().split(",");o=0;for(let e=0;e<l.length;e++)if(")"==l[e]){o=e+3;break}let c=l.substring(o,l.length-1).trim().split(",");o=0;for(let e=0;e<r.length;e++)if(")"==r[e]){o=e+3;break}let d=r.substring(o,r.length-1).trim().split(",");for(let t=0;t<a.length;t++)e.solution[a[t]]=c[t],e.solution[a[t]+"_float"]=d[t];e.updateHTML()},error:function(e,t,i){console.error(e)}})}placeVariables(e){let t="",i="",n="",s=!1;const l=e.length;for(let r=0;r<l;r++){let l=e[r];if("`"==l)i="$"==i?"":"$",n.length>0&&(n in this.solution?t+=this.solution[n]:t+=n),t+=l;else if("$"==i)if(l>="A"&&l<="Z"||l>="a"&&l<="z")n+=l;else if(n.length>0&&l>="0"&&l<="9")n+=l;else{if(n.length>0){if(n in this.solution)if(s){let e=5,i=new h;i.ident=n,this.inputs.push(i),t+='` <input type="text" value="" id="stackquiz-'+this.id+"-input-"+n+'" size="'+e+'" placeholder=""> ',t+=' <span id="stackquiz-'+this.id+"-feedback-"+n+'"></span>` '}else t+=this.solution[n];else t+=n;n=""}"#"==l?s=!0:(s=!1,t+=l)}else t+=l}return t}updateHTML(){let e="";for(let t in this.solution)e.length>0&&(e+=", "),e+=t+"="+this.solution[t];let t="";t+='<div class="card border-dark">',t+='<div class="card-body">\n',t+='<span class="h2 py-1 my-1"><i class="fas fa-question-circle"></i> '+this.title+"</span><br/>\n",t+=this.placeVariables(this.text.replaceAll("$","`")),t+='<button type="button" class="btn btn-primary" onclick="slw.eval_stack(\''+this.id+"');\">"+u("evaluate")+"</button> ",t+='<button type="button" class="btn btn-outline-primary" data-bs-toggle="tooltip" data-bs-placement="bottom" title="export to Moodle-XML"  onclick=""><i class="fas fa-file-export"></i></button> ',t+='&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span id="general_feedback"></span><br/>',t+="</div>\n",t+='<div class="card-footer text-muted">',t+="<b>Variablen:</b>",t+='<p class="font-monospace">'+e+"</p>",t+="</div>\n",t+='<div class="card-footer text-muted">',t+="<b>Lösung:</b> ",t+=this.placeVariables(this.solutiontext.replaceAll("$","`")),t+="</div>\n",t+="</div>\n",document.getElementById("stackquiz-"+this.id).innerHTML=t}}var f;!function(e){e[e.JavaBlock=0]="JavaBlock"}(f||(f={}));class g{constructor(){this.id=0,this.type=f.JavaBlock,this.title="",this.text="",this.given="",this.asserts=[],this.forbiddenKeywords=[],this.requiredKeywords=[],this.solution="",this.editor=null}refresh(){}evaluate(){let e=this.editor.getValue().split("\n"),t=this.given.split("\n"),i="";for(let n=0;n<e.length;n++)n<t.length?i+=t[n]+"\n":i+=e[n]+"\n";i=i.replaceAll("§","");let n={type:"JavaBlock",source:i,asserts:this.asserts,language:o},s=document.getElementById("programming-feedback-"+this.id),l=u("please_wait");s.innerHTML='<span class="text-danger">'+l+"</span>",$.ajax({type:"POST",url:"services/prog.php",data:{input:JSON.stringify(n)},success:function(e){let t=(e=JSON.parse(e)).status,i=e.msg;s.innerHTML=("ok"===t?a:c)+" ",s.innerHTML+=" &nbsp; <code>"+i.replaceAll("\n","<br/>").replaceAll(" ","&nbsp;")+"</code>"},error:function(e,t,i){console.error(e)}})}updateHTML(){let e="";e+='<div class="card border-dark">',e+='<div class="card-body">\n',e+='<span class="h2 py-1 my-1"><i class="fas fa-keyboard"></i> '+this.title+"</span><br/>\n",e+=this.text,e+='<div class="border p-0 m-0"><textarea class="form-control p-0" style="min-width: 100%;" id="programming-editor-'+this.id+'" + rows="5"></textarea></div>',e+='<p id="programming-feedback-'+this.id+'"></p>';e+='<button type="button" class="btn btn-primary" onclick="slw.eval_prog(\''+this.id+"')\">Auswerten</button> ",e+="</div>\n",e+="</div>\n",document.getElementById("programming-"+this.id).innerHTML=e,this.editor=l.fromTextArea(document.getElementById("programming-editor-"+this.id),{mode:"text/x-java",lineNumbers:!0,lineWrapping:!0});let t=this.given.replace(/§\d*§/g,"?")+"\n";this.editor.setValue(t);let i=this;this.editor.on("beforeChange",(function(e,t){t.from.line<i.given.split("\n").length-1&&t.cancel()}))}}class v{constructor(){this.id=0,this.title="",this.src=""}error(e){document.getElementById("plot2d-img-"+this.id).innerHTML='<p class="text-danger">Error: '+e+"</p>"}refresh(){let e=document.getElementById("plot2d-img-"+this.id),t="\\documentclass[class=minimal,border=0pt]{standalone}\n\\usepackage[latin1]{inputenc}\n\\usepackage{tikz}\n\\begin{document}\n\\pagestyle{empty}\n\\begin{tikzpicture}[domain=_X_START_:_X_END_]\n    \\draw[very thin,color=gray] _GRID_START_ grid _GRID_END_;\n    \\draw[->] _X_AXIS_START_ -- _X_AXIS_END_ node[right] {$x$};\n    \\draw[->] _Y_AXIS_START_ -- _Y_AXIS_END_ node[above] {$y$};\n_FUNCTIONS_\n\\end{tikzpicture}\n\\end{document}\n",i=-1,n=1,s=-1,l=1,r="",o=0,a=this.src.split("\n");for(let e=0;e<a.length;e++){let t=a[e];if(0!=t.trim().length)if(t.startsWith("xaxis")||t.startsWith("yaxis")){let e=t.startsWith("xaxis"),r=t.substr(5).trim().split(",");if(2!=r.length||isNaN(parseFloat(r[0]))||isNaN(parseFloat(r[1])))return void this.error("Definition of 'xaxis' must have format 'xaxis START, END'");e?(i=parseFloat(r[0]),n=parseFloat(r[1])):(s=parseFloat(r[0]),l=parseFloat(r[1]))}else{if(!t.startsWith("plot"))return void this.error("unknown command in line: '"+t+"'");{let e=t.substr(4).trim().split("=");if(2!=e.length)return void this.error("Definition of 'plot' must have format 'plot ID = TERM'");let i=e[0].trim(),n=e[1].trim(),s=["red","blue","orange"];r+="\t\\draw[color="+s[o%s.length]+"] plot function{"+n+"}\n",r+="\t\tnode[right] {$"+i+"$};\n",o++}}}t=t.replaceAll("_X_START_",""+i),t=t.replaceAll("_X_END_",""+n),t=t.replaceAll("_GRID_START_","("+(i-.1)+","+(s-.1)+")"),t=t.replaceAll("_GRID_END_","("+(n+.1)+","+(l+.1)+")"),t=t.replaceAll("_X_AXIS_START_","("+(i-.2)+",0)"),t=t.replaceAll("_X_AXIS_END_","("+(n+.2)+",0)"),t=t.replaceAll("_Y_AXIS_START_","(0,"+(s-.2)+")"),t=t.replaceAll("_Y_AXIS_END_","(0,"+(l+.2)+")"),t=t.replaceAll("_FUNCTIONS_",r);$.ajax({type:"POST",url:"services/plot2d.php",data:{input:t},success:function(t){e.innerHTML='<img src="'+t+'" class="img-fluid" width="320px"/>'},error:function(e,t,i){console.error(e)}})}updateHTML(){let e="";e+='<div class="card border-dark">',e+='<div class="card-body">\n',e+='<span class="h2 py-1 my-1">'+this.title+"</span><br/>\n",e+='<p id="plot2d-img-'+this.id+'"></p>',e+="</div>\n",e+="</div>\n",document.getElementById("plot2d-"+this.id).innerHTML=e}}class b{constructor(){this.title="",this.html="",this.sellQuizzes=[],this.stackQuizzes=[],this.programmingQuizzes=[],this.plot2ds=[]}refresh(){for(let e of this.stackQuizzes)e.updateHTML(),e.refresh();for(let e of this.programmingQuizzes)e.updateHTML(),e.refresh();for(let e of this.plot2ds)e.updateHTML(),e.refresh()}}const y='\n<div id="container" class="container">\n    <br/>\n    <p class="text-center">\n        <span class="display-1">$TITLE$</span>\n    </p>\n    <p class="text-center lead">\n        $LEADTEXT$\n    </p>\n</div>\n<div id="container" class="container">\n    <div class="row">\n        <div class="col-sm">\n            $CONTENT$\n        </div>\n    </div>\n</div>\n';class _{compile(e,t=!0){let i=new b,n=e.split("\n"),s="",l=1,r=1,o=1,a=1,c=1,d=["definition","theorem","remark","sell","stack","javablock","plot2d"],h=[],f=[],_="",k=0,T="",x=!1;for(let e=0;e<n.length;e++){let t=n[e];if(t.startsWith("%"));else if(x&&!t.startsWith("---")){let e=!1;if(0==_.length){for(let i of d)if(t.toLowerCase().startsWith(i+".")){T=i,_+=t.substring((i+".").length).trim()+"\n",e=!0;break}e||(_+=t+"\n")}else _+=t+"\n"}else if(h.length>0&&(t.startsWith(" ")||t.startsWith("\t")))h[h.length-1]+=t;else if(h.length>0&&!t.startsWith("* ")){s+="<ul>";for(let e of h)s+="<li>"+e.replaceAll("$","`")+"</li>";s+="</ul>",h=[]}else if(f.length>0&&(t.startsWith(" ")||t.startsWith("\t")))f[f.length-1]+=t;else if(f.length>0&&!t.startsWith("- ")){s+="<ol>";for(let e of f)s+="<li>"+e+"</li>";s+="</ol>",f=[]}else if(t.startsWith("* "))h.push(t.substring(2));else if(t.startsWith("- "))f.push(t.substring(2));else if(t.trim().startsWith("$")&&t.length>1&&(" "==t[0]||"\t"==t[0]))s+='\n                <div class="" style="position:relative">\n                    <p class="text-center" style="position:absolute;width:100%;">\n                        '+t.trim().replaceAll("$","`")+'\n                    </p>\n                    <p class="text-end" style="position:absolute;width:100%;">\n                        (`'+c+"`)\n                    </p>\n                </div>",s+="<br/>",c++;else if(t.startsWith("#####"))i.title=t.substring(5).trim();else if(t.startsWith("###"))s+='<a onclick="slw.jump('+e+');" style="cursor:pointer;">',s+="<h3>"+l+"."+r+"."+o+". "+t.substring(3).trim()+"</h3>\n",s+="</a>\n",o+=1;else if(t.startsWith("##"))s+='<a onclick="slw.jump('+e+');" style="cursor:pointer;">',s+="<h2>"+l+"."+r+". "+t.substring(2).trim()+"</h2>\n",s+="</a>\n",r+=1,o=1;else if(t.startsWith("#"))s+='<a onclick="slw.jump('+e+');" style="cursor:pointer;">',s+="<h1>"+l+". "+t.substring(1).trim()+"</h1>",s+="</a>\n",l+=1,r=1,o=1,a=1;else if(t.startsWith("---"))if(x=!x,0==x){if("sell"===T){let e=new p;e.id=i.sellQuizzes.length,e.src=_,i.sellQuizzes.push(e),s+='<div id="sellquiz-'+e.id+'"></div>\n'}else if("plot2d"===T){let e=new v;e.id=i.plot2ds.length,e.title="",e.src="";let t=_.split("\n");for(let i=0;i<t.length;i++)0==i?e.title=t[i]:e.src+=t[i]+"\n";i.plot2ds.push(e),s+='<div id="plot2d-'+e.id+'"></div>\n'}else if("javablock"===T){let e=this.compile_parts(_,["@text","@given","@asserts","@forbidden-keywords","@required-keywords","@solution"]);if(e.error.length>0)s+="error: "+e.error;else{let t=new g;t.id=i.programmingQuizzes.length,t.title=e["@title"],t.text=this.compile(e["@text"],!1).html,t.given=this.removeEmptyLines(e["@given"]),t.asserts=this.removeEmptyLines(e["@asserts"]).split("\n"),t.forbiddenKeywords=this.removeEmptyLines(e["@forbidden-keywords"]).split("\n"),t.requiredKeywords=this.removeEmptyLines(e["@required-keywords"]).split("\n"),t.solution=e["@solution"],i.programmingQuizzes.push(t),s+='<div id="programming-'+t.id+'"></div>\n'}}else if("stack"===T){let e=new m;e.id=i.stackQuizzes.length,i.stackQuizzes.push(e);let t=this.compile_parts(_,["@code","@text","@solution"]);if(e.error=t.error,0==e.error.length){e.title=t["@title"],e.code=t["@code"],e.text=this.compile(t["@text"],!1).html,e.solutiontext=this.compile(t["@solution"],!1).html;let i=e.code.split("\n");e.code="display2d:false;\n",e.code+="stardisp:true;\n";for(let t=0;t<i.length;t++){if(i[t].startsWith(" ")||i[t].startsWith("\t"))continue;let n=i[t].trim();0!=n.length&&(0==n.endsWith(";")&&(n+=";"),e.code+=n+"\n")}e.code+="values;\n",e.code+="ev(values);\n",e.code+="float(ev(values));\n"}s+='<div id="stackquiz-'+e.id+'"></div>\n'}else{s+='<div class="card border-dark">',s+='<div class="card-body">\n';let e="",t="";["definition","theorem"].includes(T)&&(t=" "+(l-1)+"."+a,a++),T.length>0&&(e='<a onclick="slw.jump('+k+');" style="cursor:pointer;">',e+="<b>"+u(T)+t+"</b> ",e+="</a>");let i=this.compile(_,!1);i.html.startsWith("<p>")?i.html="<p>"+e+i.html.substring(3):i.html=e+i.html,s+=i.html,s+="</div>\n",s+="</div>\n"}_=""}else k=e,T="";else s+="<p>"+t.replaceAll("$","`")+"</p>\n"}return t?(i.html=y.replaceAll("$TITLE$",i.title),i.html=i.html.replaceAll("$LEADTEXT$",""),i.html=i.html.replaceAll("$CONTENT$",s)):i.html=s,i}compile_parts(e,t){let i={error:""};for(let e of t)i[e]="";let n="",s=e.split("\n");for(let e=0;e<s.length;e++){let l=s[e];0==e&&(i["@title"]=l),0!=l.trim().length&&(l.startsWith("@")&&(l=l.trim()),t.includes(l)?(n=l,i[n]=""):l.startsWith("@")?i.error="error: unknown part '"+l+"'":i[n]+=l+"\n")}return i}removeEmptyLines(e){let t="";const i=e.split("\n"),n=i.length;for(let e=0;e<n;e++)i[e].trim().length>0&&(t.length>0&&(t+="\n"),t+=i[e]);return t}}function k(){alert("unimplemented")}function T(){let t=new _;e.compilerOutput=t.compile(e.editor.getValue()),document.getElementById("rendered-content").innerHTML=e.compilerOutput.html,e.compilerOutput.refresh(),r.reset(),r.setLanguage(o);const i=e.compilerOutput.sellQuizzes.length;for(let t=0;t<i;t++){let i=document.getElementById("sellquiz-"+t),n=r.createQuestion(e.compilerOutput.sellQuizzes[t].src);if(r.setQuestionHtmlElement(n,i),n<0){let e='<div class="card border-dark"><div class="card-body">';e+='<p class="text-danger"><b>'+r.getErrorLog().replaceAll("\n","<br/>")+"</b></p>",e+="</div></div>",i.innerHTML=e}else{let e=r.getQuestionHighLevelHTML(n);i.innerHTML=e,r.refreshQuestion(n)}}}return e.editor=null,e.compilerOutput=null,e.eval_prog=function(t){null!=e.compilerOutput&&e.compilerOutput.programmingQuizzes[t].evaluate()},e.eval_stack=function(t){null!=e.compilerOutput&&e.compilerOutput.stackQuizzes[t].evaluate()},e.init=function(){e.editor=l.fromTextArea(document.getElementById("editor"),{mode:"sellquiz-edit",lineNumbers:!0,lineWrapping:!0,styleActiveLine:{nonEmpty:!0},extraKeys:{"Ctrl-S":function(e){k()},"Cmd-S":function(e){k()},"Ctrl-F":function(e){alert("searching text is unimplemented!")},"Cmd-F":function(e){alert("searching text is unimplemented!")},F1:function(e){T()},F2:function(e){document.getElementById("insertCodeButton").click()}}}),e.editor.setSize(null,"100%");let t=["Document Title","\n##### My Title\n","Section","\n# My Section\n","Subsection","\n## My Subsection\n","Subsubsection","\n### My Subsubsection\n","Definition","\n---\nDef.\n---\n\n","Theorem","\n---\nTheorem.\n---\n\n","SELL-Quiz","\n---\nSell. My Quiz\n\tx, y in {1,2,3}\n\\tz := x + y\n$ x + y = #z $\n---\n\n","STACK-Quiz","\n---\nStack. My Quiz\n\n@code\nx:rand(10)\ny:rand(10)\nz:x+y;\n\n@text\n$x+y=#z$\n\n@solution\nJust add both numbers!\n---\n\n"],i="";for(let e=0;e<t.length/2;e++){let n=t[2*e+0];i+='<a class="list-group-item list-group-item-action"\n                    onclick="insertCode(\''+t[2*e+1].replaceAll("\n","\\n").replaceAll("\t","\\t")+'\');"\n                    style="cursor:pointer;"\n                    >'+n+"</a>"}document.getElementById("insertCodeList").innerHTML=i,$.ajax({type:"POST",url:"services/read.php",data:{path:"data/files/hello.txt"},success:function(t){e.editor.setValue(t),T()},error:function(e,t,i){console.error(e)}})},e.insertCode=function(t){var i=e.editor.getDoc(),n=i.getCursor();i.replaceRange(t,n)},e.jump=function(t){e.editor.scrollTo(null,e.editor.charCoords({line:t,ch:0},"local").top)},e.redo=function(){e.editor.redo()},e.save=k,e.undo=function(){e.editor.undo()},e.update=T,Object.defineProperty(e,"__esModule",{value:!0}),e}({},CodeMirror,sellquiz);
