var slw=function(e,t,n){"use strict";function i(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var s,l=i(t),r=i(n);s=function(e){var t="CodeMirror-activeline",n="CodeMirror-activeline-background",i="CodeMirror-activeline-gutter";function s(e){for(var s=0;s<e.state.activeLines.length;s++)e.removeLineClass(e.state.activeLines[s],"wrap",t),e.removeLineClass(e.state.activeLines[s],"background",n),e.removeLineClass(e.state.activeLines[s],"gutter",i)}function l(e,l){for(var r=[],o=0;o<l.length;o++){var a=l[o],c=e.getOption("styleActiveLine");if("object"==typeof c&&c.nonEmpty?a.anchor.line==a.head.line:a.empty()){var u=e.getLineHandleVisualStart(a.head.line);r[r.length-1]!=u&&r.push(u)}}(function(e,t){if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!=t[n])return!1;return!0})(e.state.activeLines,r)||e.operation((function(){s(e);for(var l=0;l<r.length;l++)e.addLineClass(r[l],"wrap",t),e.addLineClass(r[l],"background",n),e.addLineClass(r[l],"gutter",i);e.state.activeLines=r}))}function r(e,t){l(e,t.ranges)}e.defineOption("styleActiveLine",!1,(function(t,n,i){var o=i!=e.Init&&i;n!=o&&(o&&(t.off("beforeSelectionChange",r),s(t),delete t.state.activeLines),n&&(t.state.activeLines=[],l(t,t.listSelections()),t.on("beforeSelectionChange",r)))}))},"object"==typeof e&&"object"==typeof module?s(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],s):s(CodeMirror);const o={def_en:"Definition",def_de:"Definition",theorem_en:"Theorem",theorem_de:"Satz",remark_en:"Remark",remark_de:"Bemerkung"};class a{constructor(){this.id=0,this.src=""}}class c{constructor(){this.id=0,this.title="",this.code="",this.text="",this.solutiontext="",this.error="",this.solution={}}refresh(){let e=this;$.ajax({type:"POST",url:"../services/maxima.php",data:{input:this.code},success:function(t){let n=t.split("\n"),i="",s="",l="";for(let e=0;e<n.length;e++){let t=n[e].trim();t.endsWith(") values")?i="v":t.endsWith(") ev(values)")?i="ev":"v"==i?(s=t,i=""):"ev"==i&&(l=t,i="")}let r=0;for(let e=0;e<s.length;e++)if(")"==s[e]){r=e+3;break}let o=s.substring(r,s.length-1).trim().split(",");r=0;for(let e=0;e<l.length;e++)if(")"==l[e]){r=e+3;break}let a=l.substring(r,l.length-1).trim().split(",");for(let t=0;t<o.length;t++)e.solution[o[t]]=a[t];e.updateHTML()},error:function(e,t,n){console.error(e)}})}placeVariables(e){let t="",n="",i="",s=!1;const l=e.length;for(let r=0;r<l;r++){let l=e[r];if("`"==l)n="$"==n?"":"$",i.length>0&&(i in this.solution?t+=this.solution[i]:t+=i),t+=l;else if("$"==n)if(l>="A"&&l<="Z"||l>="a"&&l<="z")i+=l;else if(i.length>0&&l>="0"&&l<="9")i+=l;else{if(i.length>0){if(i in this.solution)if(s){t+='` <input type="text" value="" id="" size="'+5+'" placeholder="">` '}else t+=this.solution[i];else t+=i;i=""}"#"==l?s=!0:(s=!1,t+=l)}else t+=l}return t}updateHTML(){let e="";for(let t in this.solution)e.length>0&&(e+=", "),e+=t+"="+this.solution[t];let t="";t+='<div class="card border-dark">',t+='<div class="card-body">\n',t+='<span class="h2 py-1 my-1"><i class="fas fa-question-circle"></i> '+this.title+"</span><br/>\n",t+=this.placeVariables(this.text.replaceAll("$","`")),t+="<span>";t+='<button type="button" class="btn btn-primary" onclick="">Auswerten</button> ',t+='&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span id="general_feedback"><br/>',t+="</div>\n",t+='<div class="card-footer text-muted">',t+="<b>Variablen:</b>",t+='<p class="font-monospace">'+e+"</p>",t+="</div>\n",t+='<div class="card-footer text-muted">',t+="<b>LÃ¶sung:</b> ",t+=this.placeVariables(this.solutiontext.replaceAll("$","`")),t+="</div>\n",t+="</div>\n",document.getElementById("stackquiz-"+this.id).innerHTML=t}}class u{constructor(){this.title="",this.html="",this.sellQuizzes=[],this.stackQuizzes=[]}refreshQuizzes(){for(let e of this.stackQuizzes)e.updateHTML(),e.refresh()}}const d='\n<div id="container" class="container">\n    <br/>\n    <p class="text-center">\n        <span class="display-1">$TITLE$</span>\n    </p>\n    <p class="text-center lead">\n        $LEADTEXT$\n    </p>\n</div>\n<div id="container" class="container">\n    <div class="row">\n        <div class="col-sm">\n            $CONTENT$\n        </div>\n    </div>\n</div>\n';class h{compile(e,t=!0){let n=new u,i=e.split("\n"),s="",l=1,r=1,h=1,f=1,p=1,m=["def","theorem","remark","sell","stack"],g=[],b=[],v="",y=0,z="",L=!1;for(let e=0;e<i.length;e++){let t=i[e];if(t.startsWith("%"));else if(L&&!t.startsWith("---")){let e=!1;if(0==v.length){for(let n of m)if(t.toLowerCase().startsWith(n+".")){z=n,v+=t.substring((n+".").length).trim()+"\n",e=!0;break}e||(v+=t+"\n")}else v+=t+"\n"}else if(g.length>0&&(t.startsWith(" ")||t.startsWith("\t")))g[g.length-1]+=t;else if(g.length>0&&!t.startsWith("* ")){s+="<ul>";for(let e of g)s+="<li>"+e.replaceAll("$","`")+"</li>";s+="</ul>",g=[]}else if(b.length>0&&(t.startsWith(" ")||t.startsWith("\t")))b[b.length-1]+=t;else if(b.length>0&&!t.startsWith("- ")){s+="<ol>";for(let e of b)s+="<li>"+e+"</li>";s+="</ol>",b=[]}else if(t.startsWith("* "))g.push(t.substring(2));else if(t.startsWith("- "))b.push(t.substring(2));else if(t.trim().startsWith("$")&&t.length>1&&(" "==t[0]||"\t"==t[0]))s+='\n                <div class="" style="position:relative">\n                    <p class="text-center" style="position:absolute;width:100%;">\n                        '+t.trim().replaceAll("$","`")+'\n                    </p>\n                    <p class="text-end" style="position:absolute;width:100%;">\n                        (`'+p+"`)\n                    </p>\n                </div>",s+="<br/>",p++;else if(t.startsWith("#####"))n.title=t.substring(5).trim();else if(t.startsWith("###"))s+='<a onclick="slw.jump('+e+');" style="cursor:pointer;">',s+="<h3>"+l+"."+r+"."+h+". "+t.substring(3).trim()+"</h3>\n",s+="</a>\n",h+=1;else if(t.startsWith("##"))s+='<a onclick="slw.jump('+e+');" style="cursor:pointer;">',s+="<h2>"+l+"."+r+". "+t.substring(2).trim()+"</h2>\n",s+="</a>\n",r+=1,h=1;else if(t.startsWith("#"))s+='<a onclick="slw.jump('+e+');" style="cursor:pointer;">',s+="<h1>"+l+". "+t.substring(1).trim()+"</h1>",s+="</a>\n",l+=1,r=1,h=1,f=1;else if(t.startsWith("---"))if(L=!L,0==L){if("sell"===z){let e=new a;e.id=n.sellQuizzes.length,e.src=v,n.sellQuizzes.push(e),s+='<div id="sellquiz-'+e.id+'"></div>\n'}else if("stack"===z){let e=new c;e.id=n.stackQuizzes.length,n.stackQuizzes.push(e);let t="",i=v.split("\n");for(let n=0;n<i.length;n++){let s=i[n];if(0==n)e.title=s;else if(s.startsWith("@code"))t="code";else if(s.startsWith("@text"))t="text";else if(s.startsWith("@solution"))t="solution";else{if(s.startsWith("@")){e.error="error: unknown part '"+s+"'";break}if("code"===t)e.code+=s+"\n";else if("text"===t)e.text+=s+"\n";else if("solution"===t)e.solutiontext+=s+"\n";else if(s.trim().length>0){e.error="unexpected line '"+s+"'";break}}}if(0==e.error.length){let t=this.compile(e.text,!1);e.text=t.html,t=this.compile(e.solutiontext,!1),e.solutiontext=t.html;let n=e.code.split("\n");e.code="display2d:false;\n",e.code+="stardisp:true;\n";for(let t=0;t<n.length;t++){let i=n[t].trim();0!=i.length&&(0==i.endsWith(";")&&(i+=";"),e.code+=i+"\n")}e.code+="values;\n",e.code+="ev(values);\n"}s+='<div id="stackquiz-'+e.id+'"></div>\n'}else{s+='<div class="card border-dark">',s+='<div class="card-body">\n';let e="",t="";["def","theorem"].includes(z)&&(t=" "+(l-1)+"."+f,f++),z.length>0&&(e='<a onclick="slw.jump('+y+');" style="cursor:pointer;">',e+="<b>"+o[z+"_de"]+t+"</b> ",e+="</a>");let n=this.compile(v,!1);n.html.startsWith("<p>")?n.html="<p>"+e+n.html.substring(3):n.html=e+n.html,s+=n.html,s+="</div>\n",s+="</div>\n"}v=""}else y=e,z="";else s+="<p>"+t.replaceAll("$","`")+"</p>\n"}return t?(n.html=d.replaceAll("$TITLE$",n.title),n.html=n.html.replaceAll("$LEADTEXT$",""),n.html=n.html.replaceAll("$CONTENT$",s)):n.html=s,n}}function f(){alert("unimplemented")}function p(){let t=(new h).compile(e.editor.getValue());document.getElementById("rendered-content").innerHTML=t.html,t.refreshQuizzes(),r.reset(),r.setLanguage("de");const n=t.sellQuizzes.length;for(let e=0;e<n;e++){let n=document.getElementById("sellquiz-"+e),i=r.createQuestion(t.sellQuizzes[e].src);if(r.setQuestionHtmlElement(i,n),i<0){let e='<div class="card border-dark"><div class="card-body">';e+='<p class="text-danger"><b>'+r.getErrorLog().replaceAll("\n","<br/>")+"</b></p>",e+="</div></div>",n.innerHTML=e}else{let e=r.getQuestionHighLevelHTML(i);n.innerHTML=e,r.refreshQuestion(i)}}}return e.editor=null,e.init=function(){e.editor=l.fromTextArea(document.getElementById("editor"),{lineNumbers:!0,lineWrapping:!0,styleActiveLine:{nonEmpty:!0},extraKeys:{"Ctrl-S":function(e){f()},"Cmd-S":function(e){f()},"Ctrl-F":function(e){alert("searching text is unimplemented!")},"Cmd-F":function(e){alert("searching text is unimplemented!")},F1:function(e){p()},F2:function(e){document.getElementById("insertCodeButton").click()}}}),e.editor.setSize(null,"100%");let t=["Document Title","\n##### My Title\n","Section","\n# My Section\n","Subsection","\n## My Subsection\n","Subsubsection","\n### My Subsubsection\n","Definition","\n---\nDef.\n---\n\n","Theorem","\n---\nTheorem.\n---\n\n","SELL-Quiz","\n---\nSell. My Quiz\n\tx, y in {1,2,3}\n\\tz := x + y\n$ x + y = #z $\n---\n\n","STACK-Quiz","\n---\nStack. My Quiz\n\n@code\nx:rand(10)\ny:rand(10)\nz:x+y;\n\n@text\n$x+y=#z$\n\n@solution\nJust add both numbers!\n---\n\n"],n="";for(let e=0;e<t.length/2;e++){let i=t[2*e+0];n+='<a class="list-group-item list-group-item-action"\n                    onclick="insertCode(\''+t[2*e+1].replaceAll("\n","\\n").replaceAll("\t","\\t")+'\');"\n                    style="cursor:pointer;"\n                    >'+i+"</a>"}document.getElementById("insertCodeList").innerHTML=n,$.ajax({type:"POST",url:"services/read.php",data:{path:"data/files/hello.txt"},success:function(t){e.editor.setValue(t),p()},error:function(e,t,n){console.error(e)}})},e.insertCode=function(t){var n=e.editor.getDoc(),i=n.getCursor();n.replaceRange(t,i)},e.jump=function(t){e.editor.scrollTo(null,e.editor.charCoords({line:t,ch:0},"local").top)},e.redo=function(){e.editor.redo()},e.save=f,e.undo=function(){e.editor.undo()},e.update=p,Object.defineProperty(e,"__esModule",{value:!0}),e}({},CodeMirror,sellquiz);
